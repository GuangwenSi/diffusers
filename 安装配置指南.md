# ğŸ¤— Diffusers å®‰è£…é…ç½®æŒ‡å—

## ç›®å½•

1. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
2. [Pythonè™šæ‹Ÿç¯å¢ƒé…ç½®](#pythonè™šæ‹Ÿç¯å¢ƒé…ç½®)
3. [åŸºç¡€å®‰è£…](#åŸºç¡€å®‰è£…)
4. [å®Œæ•´å®‰è£…ï¼ˆå¼€å‘æ¨¡å¼ï¼‰](#å®Œæ•´å®‰è£…å¼€å‘æ¨¡å¼)
5. [GPUæ”¯æŒé…ç½®](#gpuæ”¯æŒé…ç½®)
6. [å¯é€‰ä¾èµ–å®‰è£…](#å¯é€‰ä¾èµ–å®‰è£…)
7. [éªŒè¯å®‰è£…](#éªŒè¯å®‰è£…)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿè¦æ±‚

### æ“ä½œç³»ç»Ÿ
- **Windows 10/11** âœ…
- **Linux** âœ…
- **macOS** âœ…ï¼ˆåŒ…æ‹¬Apple Silicon M1/M2ï¼‰

### Pythonç‰ˆæœ¬
- **Python 3.8+**ï¼ˆæ¨è 3.9 æˆ– 3.10ï¼‰

### ç¡¬ä»¶è¦æ±‚
- **CPU**ï¼šç°ä»£å¤šæ ¸å¤„ç†å™¨
- **GPU**ï¼ˆå¯é€‰ä½†æ¨èï¼‰ï¼š
  - NVIDIA GPU with CUDA supportï¼ˆæ¨èç”¨äºè®­ç»ƒå’Œå¿«é€Ÿæ¨ç†ï¼‰
  - è‡³å°‘ 4GB VRAMï¼ˆæ¨ç†ï¼‰ï¼Œ8GB+ VRAMï¼ˆè®­ç»ƒï¼‰

---

## Pythonè™šæ‹Ÿç¯å¢ƒé…ç½®

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ venvï¼ˆæ¨èï¼‰

#### Windows PowerShell

```powershell
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\Activate.ps1

# å¦‚æœé‡åˆ°æ‰§è¡Œç­–ç•¥é”™è¯¯ï¼Œå…ˆè¿è¡Œï¼š
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# 3. å‡çº§pip
python -m pip install --upgrade pip
```

#### Windows CMD

```cmd
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
venv\Scripts\activate.bat

# 3. å‡çº§pip
python -m pip install --upgrade pip
```

#### Linux/macOS

```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# 3. å‡çº§pip
python -m pip install --upgrade pip
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ condaï¼ˆæ¨èç”¨äºGPUç¯å¢ƒï¼‰

```bash
# 1. åˆ›å»ºcondaç¯å¢ƒ
conda create -n diffusers python=3.10

# 2. æ¿€æ´»ç¯å¢ƒ
conda activate diffusers

# 3. å®‰è£…PyTorchï¼ˆæ ¹æ®ä½ çš„CUDAç‰ˆæœ¬é€‰æ‹©ï¼‰
# CUDA 11.8
conda install pytorch torchvision torchaudio pytorch-cuda=11.8 -c pytorch -c nvidia

# CUDA 12.1
conda install pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia

# CPU only
conda install pytorch torchvision torchaudio cpuonly -c pytorch
```

---

## åŸºç¡€å®‰è£…

### ä»…å®‰è£…æ ¸å¿ƒåº“ï¼ˆæ¨èç”¨äºå¿«é€Ÿå¼€å§‹ï¼‰

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒåæ‰§è¡Œ
pip install diffusers[torch]
```

### å®‰è£…å®Œæ•´åŠŸèƒ½ï¼ˆåŒ…å«æ‰€æœ‰å¯é€‰ä¾èµ–ï¼‰

```bash
pip install diffusers[torch,training,test,quality]
```

### ä½¿ç”¨condaå®‰è£…ï¼ˆç¤¾åŒºç»´æŠ¤ï¼‰

```bash
conda install -c conda-forge diffusers
```

---

## å®Œæ•´å®‰è£…ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

### æ­¥éª¤1ï¼šå…‹éš†ä»“åº“

```bash
# å¦‚æœè¿˜æ²¡æœ‰å…‹éš†ï¼Œæ‰§è¡Œï¼š
git clone https://github.com/huggingface/diffusers.git
cd diffusers
```

### æ­¥éª¤2ï¼šå®‰è£…é¡¹ç›®

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows PowerShell:
.\venv\Scripts\Activate.ps1

# Linux/macOS:
source venv/bin/activate

# å®‰è£…é¡¹ç›®ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
pip install -e .

# æˆ–è€…å®‰è£…å®Œæ•´å¼€å‘ä¾èµ–
pip install -e ".[dev]"
```

### æ­¥éª¤3ï¼šå®‰è£…ç¤ºä¾‹ä¾èµ–

```bash
# è¿›å…¥ç¤ºä¾‹ç›®å½•
cd examples

# å®‰è£…ç‰¹å®šç¤ºä¾‹çš„ä¾èµ–ï¼ˆä¾‹å¦‚ï¼šæ–‡æœ¬åˆ°å›¾åƒè®­ç»ƒï¼‰
cd text_to_image
pip install -r requirements.txt

# æˆ–è€…å®‰è£…æ‰€æœ‰ç¤ºä¾‹çš„åŸºç¡€ä¾èµ–
cd ..
pip install -r requirements.txt  # å¦‚æœæœ‰å…¨å±€requirements.txt
```

---

## GPUæ”¯æŒé…ç½®

### æ£€æŸ¥CUDAæ˜¯å¦å¯ç”¨

```python
import torch
print(f"CUDA available: {torch.cuda.is_available()}")
print(f"CUDA version: {torch.version.cuda}")
print(f"GPU count: {torch.cuda.device_count()}")
if torch.cuda.is_available():
    print(f"GPU name: {torch.cuda.get_device_name(0)}")
```

### å®‰è£…PyTorch with CUDA

#### æ–¹æ³•ä¸€ï¼šé€šè¿‡PyTorchå®˜ç½‘

è®¿é—® https://pytorch.org/get-started/locally/ é€‰æ‹©ä½ çš„é…ç½®ï¼Œç„¶åæ‰§è¡Œç”Ÿæˆçš„å‘½ä»¤ã€‚

ä¾‹å¦‚ï¼ŒCUDA 11.8ï¼š
```bash
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

CUDA 12.1ï¼š
```bash
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
```

#### æ–¹æ³•äºŒï¼šé€šè¿‡condaï¼ˆæ¨èï¼‰

```bash
# CUDA 11.8
conda install pytorch torchvision torchaudio pytorch-cuda=11.8 -c pytorch -c nvidia

# CUDA 12.1
conda install pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia
```

### éªŒè¯GPUå®‰è£…

```python
import torch

# æµ‹è¯•GPU
if torch.cuda.is_available():
    x = torch.randn(3, 3).cuda()
    print("GPUå·¥ä½œæ­£å¸¸ï¼")
    print(f"è®¾å¤‡: {x.device}")
else:
    print("CUDAä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨CPU")
```

---

## å¯é€‰ä¾èµ–å®‰è£…

### è®­ç»ƒç›¸å…³ä¾èµ–

```bash
# å®‰è£…è®­ç»ƒæ‰€éœ€ä¾èµ–
pip install diffusers[training]

# æˆ–å•ç‹¬å®‰è£…
pip install accelerate datasets tensorboard peft
```

### é‡åŒ–æ”¯æŒ

```bash
# BitsAndBytesé‡åŒ–ï¼ˆ8-bitå’Œ4-bitï¼‰
pip install diffusers[bitsandbytes]
# æˆ–
pip install bitsandbytes accelerate

# GGUFé‡åŒ–
pip install diffusers[gguf]
# æˆ–
pip install gguf accelerate

# Quantoé‡åŒ–
pip install diffusers[optimum_quanto]
# æˆ–
pip install optimum-quanto accelerate

# TorchAOé‡åŒ–
pip install diffusers[torchao]
# æˆ–
pip install torchao accelerate

# NVIDIA ModelOpté‡åŒ–
pip install diffusers[nvidia_modelopt]
# æˆ–
pip install "nvidia-modelopt[hf]" accelerate
```

### JAX/Flaxæ”¯æŒï¼ˆLinux/macOSï¼‰

```bash
# æ³¨æ„ï¼šWindowsä¸æ”¯æŒ
pip install diffusers[flax]
# æˆ–
pip install jax jaxlib flax
```

### å¼€å‘å·¥å…·

```bash
# ä»£ç è´¨é‡å·¥å…·
pip install diffusers[quality]
# æˆ–
pip install black ruff isort

# æµ‹è¯•å·¥å…·
pip install diffusers[test]
# æˆ–
pip install pytest pytest-xdist pytest-timeout
```

### æ–‡æ¡£æ„å»º

```bash
pip install diffusers[docs]
# æˆ–
pip install hf-doc-builder
```

---

## éªŒè¯å®‰è£…

### åŸºç¡€éªŒè¯

```python
# æµ‹è¯•å¯¼å…¥
from diffusers import DiffusionPipeline
print("âœ“ Diffuserså¯¼å…¥æˆåŠŸ")

# æµ‹è¯•ç‰ˆæœ¬
import diffusers
print(f"âœ“ Diffusersç‰ˆæœ¬: {diffusers.__version__}")
```

### å®Œæ•´åŠŸèƒ½æµ‹è¯•

```python
import torch
from diffusers import DiffusionPipeline

# æ£€æŸ¥CUDA
print(f"CUDAå¯ç”¨: {torch.cuda.is_available()}")

# æµ‹è¯•ç®€å•ç®¡é“ï¼ˆéœ€è¦ç½‘ç»œä¸‹è½½æ¨¡å‹ï¼‰
try:
    # æ³¨æ„ï¼šé¦–æ¬¡è¿è¡Œä¼šä¸‹è½½æ¨¡å‹ï¼Œéœ€è¦è¾ƒé•¿æ—¶é—´
    pipe = DiffusionPipeline.from_pretrained(
        "runwayml/stable-diffusion-v1-5",
        torch_dtype=torch.float16 if torch.cuda.is_available() else torch.float32
    )
    if torch.cuda.is_available():
        pipe = pipe.to("cuda")
    print("âœ“ ç®¡é“åŠ è½½æˆåŠŸ")
except Exception as e:
    print(f"âœ— ç®¡é“åŠ è½½å¤±è´¥: {e}")
```

### è¿è¡Œæµ‹è¯•å¥—ä»¶

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆéœ€è¦å®‰è£…testä¾èµ–ï¼‰
pytest tests/

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/pipelines/test_stable_diffusion.py

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¦†ç›–ç‡
pytest tests/ --cov=src/diffusers
```

---

## å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šPowerShellæ‰§è¡Œç­–ç•¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
æ— æ³•åŠ è½½æ–‡ä»¶ï¼Œå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„šæœ¬
```

**è§£å†³æ–¹æ³•**ï¼š
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### é—®é¢˜2ï¼šCUDAç‰ˆæœ¬ä¸åŒ¹é…

**é”™è¯¯ä¿¡æ¯**ï¼š
```
RuntimeError: CUDA error: no kernel image is available for execution
```

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥CUDAç‰ˆæœ¬ï¼š`nvidia-smi`
2. å®‰è£…åŒ¹é…çš„PyTorchç‰ˆæœ¬
3. å‚è€ƒ https://pytorch.org/get-started/locally/

### é—®é¢˜3ï¼šå†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯**ï¼š
```
RuntimeError: CUDA out of memory
```

**è§£å†³æ–¹æ³•**ï¼š
1. ä½¿ç”¨CPUæ¨¡å¼ï¼š`pipe = pipe.to("cpu")`
2. å¯ç”¨å†…å­˜ä¼˜åŒ–ï¼šä½¿ç”¨ `enable_model_cpu_offload()` æˆ– `enable_sequential_cpu_offload()`
3. ä½¿ç”¨é‡åŒ–ï¼šå®‰è£… `bitsandbytes` å¹¶ä½¿ç”¨8-bitæˆ–4-bité‡åŒ–

### é—®é¢˜4ï¼šæ¨¡å‹ä¸‹è½½ç¼“æ…¢

**è§£å†³æ–¹æ³•**ï¼š
1. ä½¿ç”¨é•œåƒç«™ç‚¹ï¼ˆå¦‚æœåœ¨ä¸­å›½ï¼‰
2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
   ```bash
   # Windows PowerShell
   $env:HF_ENDPOINT="https://hf-mirror.com"
   
   # Linux/macOS
   export HF_ENDPOINT=https://hf-mirror.com
   ```
3. æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹åˆ°æœ¬åœ°ï¼Œç„¶åä»æœ¬åœ°åŠ è½½

### é—®é¢˜5ï¼šä¾èµ–å†²çª

**è§£å†³æ–¹æ³•**ï¼š
1. ä½¿ç”¨å…¨æ–°çš„è™šæ‹Ÿç¯å¢ƒ
2. å…ˆå®‰è£…PyTorchï¼Œå†å®‰è£…diffusers
3. ä½¿ç”¨ `pip install --upgrade` å‡çº§å†²çªçš„åŒ…

---

## å¿«é€Ÿå®‰è£…è„šæœ¬

### Windows PowerShell ä¸€é”®å®‰è£…è„šæœ¬

åˆ›å»º `install.ps1`ï¼š

```powershell
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\Activate.ps1

# å‡çº§pip
python -m pip install --upgrade pip

# å®‰è£…PyTorchï¼ˆæ ¹æ®ä½ çš„CUDAç‰ˆæœ¬ä¿®æ”¹ï¼‰
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# å®‰è£…diffusers
pip install diffusers[torch,training]

# éªŒè¯å®‰è£…
python -c "from diffusers import DiffusionPipeline; print('å®‰è£…æˆåŠŸï¼')"
```

æ‰§è¡Œï¼š
```powershell
.\install.ps1
```

### Linux/macOS ä¸€é”®å®‰è£…è„šæœ¬

åˆ›å»º `install.sh`ï¼š

```bash
#!/bin/bash

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å‡çº§pip
python -m pip install --upgrade pip

# å®‰è£…PyTorchï¼ˆæ ¹æ®ä½ çš„CUDAç‰ˆæœ¬ä¿®æ”¹ï¼‰
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# å®‰è£…diffusers
pip install diffusers[torch,training]

# éªŒè¯å®‰è£…
python -c "from diffusers import DiffusionPipeline; print('å®‰è£…æˆåŠŸï¼')"
```

æ‰§è¡Œï¼š
```bash
chmod +x install.sh
./install.sh
```

---

## ä¸‹ä¸€æ­¥

å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥ï¼š

1. **æŸ¥çœ‹å¿«é€Ÿå…¥é—¨**ï¼šé˜…è¯» `docs/source/zh/quicktour.md`
2. **è¿è¡Œç¤ºä¾‹**ï¼šè¿›å…¥ `examples/inference/` ç›®å½•
3. **å¼€å§‹è®­ç»ƒ**ï¼šæŸ¥çœ‹ `examples/text_to_image/` æˆ– `examples/dreambooth/`
4. **é˜…è¯»æ–‡æ¡£**ï¼šè®¿é—® https://huggingface.co/docs/diffusers

---

## æ€»ç»“

### æœ€å°å®‰è£…ï¼ˆä»…æ¨ç†ï¼‰
```bash
python -m venv venv
source venv/bin/activate  # Windows: .\venv\Scripts\Activate.ps1
pip install --upgrade pip
pip install diffusers[torch]
```

### å®Œæ•´å®‰è£…ï¼ˆå¼€å‘+è®­ç»ƒï¼‰
```bash
python -m venv venv
source venv/bin/activate  # Windows: .\venv\Scripts\Activate.ps1
pip install --upgrade pip
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
pip install -e ".[dev]"
cd examples/text_to_image
pip install -r requirements.txt
```

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰

